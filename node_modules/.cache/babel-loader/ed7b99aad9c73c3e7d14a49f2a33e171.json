{"ast":null,"code":"import { push } from \"connected-react-router\";\nimport { signInAction, signOutAction } from \"./actions\";\nimport { auth, db, FirebaseTimestamp } from \"../../firebase/index\";\nexport const listenAuthState = () => {\n  return async dispatch => {\n    return auth.onAuthStateChanged(user => {\n      if (user) {\n        const uid = user.uid;\n        db.collection('users').doc(uid).get().then(snapshot => {\n          const data = snapshot.data();\n          dispatch(signInAction({\n            isSignedIn: true,\n            role: data.role,\n            uid: uid,\n            username: data.username\n          }));\n        });\n      } else {\n        dispatch(push('/signin'));\n      }\n    });\n  };\n};\nexport const signIn = (email, password) => {\n  return async dispatch => {\n    if (email === \"\" || password === \"\") {\n      alert('必須項目が未入力です。');\n      return false;\n    }\n\n    auth.signInWithEmailAndPassword(email, password).then(result => {\n      const user = result.user;\n\n      if (user) {\n        const uid = user.uid;\n        db.collection('users').doc(uid).get().then(snapshot => {\n          const data = snapshot.data();\n          dispatch(signInAction({\n            isSignedIn: true,\n            role: data.role,\n            uid: uid,\n            username: data.username\n          }));\n          dispatch(push('/'));\n        });\n      }\n    }).catch(() => {\n      alert(\"メールアドレスかパスワードが違います\");\n    });\n  };\n};\nexport const resetPassword = email => {\n  return async dispatch => {\n    if (email === \"\") {\n      alert('必須項目が未入力です。');\n      return false;\n    } else {\n      auth.sendPasswordResetEmail(email).then(() => {\n        alert('入力されたアドレスにパスワードリセット用のメールをお送りしました。');\n        dispatch(push('/signin'));\n      }).catch(() => {\n        alert('パスワードリセットに失敗しました。');\n      });\n    }\n  };\n};\nexport const signUp = (username, email, password, confirmPassword) => {\n  return async dispatch => {\n    if (username === \"\" || email === \"\" || password === \"\" || confirmPassword === \"\") {\n      alert('必須項目が未入力です。');\n      return false;\n    }\n\n    if (password !== confirmPassword) {\n      alert('パスワードが一致しません。もう1度お試しください。');\n      return false;\n    }\n\n    return auth.createUserWithEmailAndPassword(email, password).then(result => {\n      const user = result.user;\n\n      if (user) {\n        const uid = user.uid;\n        const timestamp = FirebaseTimestamp.now();\n        const userInitialData = {\n          created_at: timestamp,\n          email: email,\n          role: \"customer\",\n          uid: uid,\n          update_at: timestamp,\n          username: username\n        };\n        db.collection('users').doc(uid).set(userInitialData).then(() => {\n          dispatch(push('/'));\n        });\n      }\n    });\n  };\n};\nexport const signOut = () => {\n  return async dispatch => {\n    auth.signOut().then(() => {\n      dispatch(signOutAction());\n      dispatch(push('/'));\n    });\n  };\n};","map":{"version":3,"sources":["C:/Users/c.daiki/desktop/react/redux/redux-app/src/reducks/users/operations.js"],"names":["push","signInAction","signOutAction","auth","db","FirebaseTimestamp","listenAuthState","dispatch","onAuthStateChanged","user","uid","collection","doc","get","then","snapshot","data","isSignedIn","role","username","signIn","email","password","alert","signInWithEmailAndPassword","result","catch","resetPassword","sendPasswordResetEmail","signUp","confirmPassword","createUserWithEmailAndPassword","timestamp","now","userInitialData","created_at","update_at","set","signOut"],"mappings":"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","sourcesContent":["import { push } from \"connected-react-router\";\r\nimport { signInAction, signOutAction } from \"./actions\";\r\nimport { auth, db, FirebaseTimestamp } from \"../../firebase/index\"\r\n\r\nexport const listenAuthState = () => {\r\n  return async(dispatch) => {\r\n    return auth.onAuthStateChanged(user => {\r\n      if(user) {\r\n        const uid = user.uid\r\n        \r\n        db.collection('users').doc(uid).get()\r\n            .then(snapshot => {\r\n              const data = snapshot.data()\r\n\r\n              dispatch(signInAction({\r\n                isSignedIn: true,\r\n                role: data.role,\r\n                uid: uid,\r\n                username: data.username\r\n              }))\r\n            })\r\n      } else {\r\n        dispatch(push('/signin'))\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nexport const signIn = (email, password) => {\r\n  return async(dispatch) => {\r\n    if(email === \"\" || password === \"\") {\r\n      alert('必須項目が未入力です。');\r\n      return false\r\n    }\r\n\r\n    auth.signInWithEmailAndPassword(email, password)\r\n      .then(result => {\r\n        const user = result.user\r\n\r\n        if(user) {\r\n          const uid = user.uid\r\n\r\n          db.collection('users').doc(uid).get()\r\n            .then(snapshot => {\r\n              const data = snapshot.data()\r\n\r\n              dispatch(signInAction({\r\n                isSignedIn: true,\r\n                role: data.role,\r\n                uid: uid,\r\n                username: data.username\r\n              }))\r\n\r\n              dispatch(push('/'))\r\n            }\r\n          )\r\n        }\r\n      }).catch(() => {\r\n        alert(\"メールアドレスかパスワードが違います\")\r\n      })\r\n  }\r\n}\r\n\r\nexport const resetPassword = (email) => {\r\n  return async(dispatch) => {\r\n    if(email === \"\") {\r\n      alert('必須項目が未入力です。');\r\n      return false\r\n    } else {\r\n      auth.sendPasswordResetEmail(email)\r\n        .then(() => {\r\n          alert('入力されたアドレスにパスワードリセット用のメールをお送りしました。')\r\n          dispatch(push('/signin'))\r\n        }).catch(() => {\r\n          alert('パスワードリセットに失敗しました。')\r\n        })\r\n    }\r\n  }\r\n}\r\n\r\nexport const signUp = (username, email, password, confirmPassword) => {\r\n  return async(dispatch) => {\r\n    if(username === \"\" || email === \"\" || password === \"\" || confirmPassword === \"\") {\r\n      alert('必須項目が未入力です。');\r\n      return false\r\n    }\r\n    if (password !== confirmPassword) {\r\n      alert('パスワードが一致しません。もう1度お試しください。')\r\n      return false\r\n    }\r\n\r\n    return auth.createUserWithEmailAndPassword(email, password)\r\n      .then(result => {\r\n        const user = result.user;\r\n\r\n        if(user) {\r\n          const uid = user.uid;\r\n          const timestamp = FirebaseTimestamp.now();\r\n\r\n          const userInitialData = {\r\n            created_at: timestamp,\r\n            email: email,\r\n            role: \"customer\",\r\n            uid: uid,\r\n            update_at: timestamp,\r\n            username: username\r\n          };\r\n\r\n          db.collection('users').doc(uid).set(userInitialData)\r\n            .then(() => {\r\n              dispatch(push('/'))\r\n            })\r\n        }\r\n      })\r\n  }\r\n}\r\n\r\nexport const signOut = () => {\r\n  return async(dispatch) => {\r\n    auth.signOut()\r\n      .then(() => {\r\n        dispatch(signOutAction());\r\n        dispatch(push('/'))\r\n      })\r\n  }\r\n}"]},"metadata":{},"sourceType":"module"}